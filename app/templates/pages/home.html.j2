{% extends 'layouts/wrapper.html.j2' %}

{% block content %}
    <script type="module" defer src="/static/js/home.js"></script>

    {% set date_fmt = 'Do [of] MMM YYYY [at] HH:mm' %}
    {% set clocked_in = time_entries.first() and not time_entries.first().end %}

    <modal-frame :url="/frames/time_form" :modal-id="time-add-modal" :modal-title="Add new time record"></modal-frame>

    <!-- Header Stats -->
    <dynamic-frame id="time-stats" :execute-scripts="true" :url="/frames/time-stats"></dynamic-frame>

    <!-- Clock in/out Form -->
    <section id="main">
        <!-- TODO: Change this to NOT submit a form and refresh the page on change -->
        <form method="post" action="/time/add">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Time</label>
                    <input class="form-control flatpickr" type="text" name="time" id="form-time" data-date-type="datetime" required>
                </div>
            </div>

            {% if clocked_in %}
                <button class="btn btn-primary" name="clock" value="out" type="submit">Clock Out</button>
            {% else %}
                <button class="btn btn-primary" name="clock" value="in" type="submit">Clock In</button>
            {% endif %}

            <button class="btn btn-secondary" type="button" data-bs-toggle="modal" data-bs-target="#time-add-modal">Add Manually</button>
        </form>
    </section>

    <hr />

    <!-- Time Log Table -->
    <dynamic-frame id="log-table" :execute-scripts="true" :url="/frames/time-log-table"></dynamic-frame>
{% endblock content %}
